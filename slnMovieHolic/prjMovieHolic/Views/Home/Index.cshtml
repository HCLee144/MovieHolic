@model prjMovieHolic.ViewModels.CMovieFrontViewModel


@{
    ViewData["Title"] = "Home Page";
    //if (ViewBag.Login == true)
    //{
    //    string userId = ViewBag.UserId.ToString();
    //}
    
}
<style>



</style>

<h1></h1>
<div id="page1">
    <div class="body1">
        <div class="main">
            <!-- 這塊不要管它  拿掉會破圖-->
            <div class="ic">More Website Templates at <a href="https://www.webmoban.net">Website Template</a></div>


            <!-- 點播機cover Flow-->
            <!-- 放7張會顯示五張。放五張顯示三張-->
            <div class="relative">
                <div id="gallery">
                    <ul id="myRoundabout">
                        <li><img src="~/images/aa.jpg" alt=""></li>
                        <li><img src="~/images/bb.jpg" alt=""></li>
                        <li><img src="~/images/aa.jpg" alt=""></li>
                        <li><img src="~/images/aa.jpg" alt=""></li>
                        <li><img src="~/images/aa.jpg" alt=""></li>
                        <li><img src="~/images/aa.jpg" alt=""></li>
                        <li><img src="~/images/aa.jpg" alt=""></li>
                    </ul>
                </div>
            </div>


            <!--這是旁邊快速訂票浮動視窗-->

            <div class="position">
                <p>快速訂票</p>
                <select name="" id="">
                    <option value="">選擇電影</option>
                    <option value="">電影名稱電影名稱電影</option>
                    <option value="">基本上只能塞十個字</option>
                    <option value="">不然會變形喔</option>
                </select>
            </div>


            <!--熱門電影分隔線-->
            <div class="myBr"></div>
            <div class="hotMoviePlaceLine">
                <ul class="hotMoviePlaceLineMenu">
                    <li style="font-size: 26px;">現正熱映</li>
                    <li ><a href="/MovieFront/MovieIndex#hotMovie">瀏覽所有電影...</a></li>
                </ul>
            </div>
            <!-- content -->
            <!-- 熱門電影區塊-->

            <section id="">
                <div class="line1">
                    <div class="line2 wrapper">
                        <div class="movieWallMovies">

                            @foreach (var movie in Model.NowShowingMovies)
                            {
                                <!-- 熱門電影1-->
                                <div class="movieCardBig">
                                    <article class="movieCard">
                                        <a href="/MovieFront/MovieDetails?id=@movie.FId">
                                            <br>
                                            <figure>
                                                <img src="~/@movie.FPosterPath" alt="">
                                            </figure>
                                            <div>
                                                <h3>@movie.FNameCht</h3>
                                                <ul>
                                                    <li class="movieEnglishName">(@movie.FNameEng)</li>
                                                    <hr>
                                                    <li>上映日期：@movie.FScheduleStart.ToString("yyyy/MM/dd")</li>
                                                    <li>片長：@movie.FShowLength 分鐘</li>
                                                </ul>
                                            </div>
                                        </a>
                                    </article>
                                    <div class="likeAndBuy">

                                        <div><a class="buyNow" href="/OrderFront/ListSession?movieID=@movie.FId">Buy Now</a></div>
                                        <div>
                                            <p id="heart" onclick="checkLoginAndToggleFavorite('@ViewBag.UserId');" data-movie-id="@movie.FId">❤</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </section>

            <!-- / 動了會破圖-->
            <div class="ic"> <a href="https://www.webmoban.net"></a></div>
            <!-- / header-->
            <div class="myBr"></div>
            <!--第二條分隔線-->
            <div class="notYetMoviePlaceLine">
                <ul class="notYetMoviePlaceLineMenu">
                    <li style="font-size: 26px;">即將上映</li>
                    <li><a href="/MovieFront/MovieIndex#notYetMovie">瀏覽所有電影...</a></li>
                </ul>
            </div>
            <!-- 即將上映電影區塊-->
            <section id="content">
                <div class="line1">
                    <div class="line2 wrapper">
                        <div class="movieWallMovies">
                            @foreach (var movie in Model.UpcomingMovies)
                            {
                                <!-- 電影1-->
                                <div class="movieCardBig">
                                    <article class="movieCard">
                                        <a href="/MovieFront/MovieDetails?id=@movie.FId">
                                            <br>
                                            <figure>
                                                <img src="~/@movie.FPosterPath" alt="">
                                            </figure>
                                            <div>
                                                <h3>@movie.FNameCht</h3>
                                                <ul>
                                                    <li class="movieEnglishName">(@movie.FNameEng)</li>
                                                    <hr>
                                                    <li>上映日期：@movie.FScheduleStart.ToString("yyyy/MM/dd")</li>
                                                    <li>片長：@movie.FShowLength 分鐘</li>
                                                </ul>
                                            </div>
                                        </a>
                                    </article>
                                    <div class="likeAndBuy">

                                        <div><a class="buyNow" href="/OrderFront/ListSession?movieID=@movie.FId">Buy Now</a></div>
                                        <div>
                                            <p id="heart" onclick="checkLoginAndToggleFavorite(`2`)" data-movie-id="@movie.FId">❤</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
<dialog id="IamDialog" class="IamDialog">
    <p>請先登入會員！</p>
    <button id="closeDialog" class="closeDialog">確定</button>
</dialog>

@section Scripts{
    <script>

        const formdialog = document.getElementById('IamDialog');
        const btnCloseDialog = document.getElementById('closeDialog');
        //請先登入


        function checkLoginAndToggleFavorite(userId) {
            console.log(userId);
            if (typeof userId === "undefined" || userId === null) {
                login();
            } else {
                toggleFavorite();
            }
        }

        //function isLoggedIn() {
        //    // 檢查使用者登入狀態的邏輯
        //    @ViewBag.Login ==true;
        //}

        function toggleFavorite() {
            var heartIcon = document.getElementById('heart');
            var movieId = heartIcon.getAttribute('data-movie-id');
            var isFavorite = checkIfFavorite(movieId);

            if (isFavorite) {
                cancelFavorite();
                heartIcon.classList.remove('active');
            } else {
                addToFavorites(movieId);
                heartIcon.classList.add('active');
            }
        }

        function checkIfFavorite(movieId) {
            // 檢查影片是否已經被收藏的邏輯
        }

        function addToFavorites(movieId) {
            // 加入收藏的邏輯
        }

        // 從收藏中移除的邏輯
        //function cancelFavorite() {
        //    var memberId = Model.tmember.FMemberId;
        //    var movieId = document.getElementById('heart').getAttribute('data-movie-id');

        //    $.ajax({
        //        url: '/memberFront/favoriteCancel',
        //        type: 'POST',
        //        data: { FMemberId: memberId, FMovieId: movieId },
        //        success: function (response) {
        //            // 成功處理回應的程式碼
        //            // 例如，重新載入喜愛清單
        //            alert('取消收藏成功')
        //            location.reload();

        //        },
        //        error: function (xhr, status, error) {
        //            // 處理錯誤的程式碼
        //            alert('失敗')
        //        }
        //    });

        function login() {
            // 執行登入操作的邏輯
                formdialog.showModal();
                btnCloseDialog.addEventListener('click', () => {
                    // 關閉 <dialog>
                    formdialog.close();
                    window.location.href = "/memberFront/memberLogin";

                });
        }







        //function cancelFavorite() {
        //    var memberId = Model.tmember.FMemberId;
        //    var movieId = document.getElementById('heart').getAttribute('data-movie-id');

        //    $.ajax({
        //        url: '/memberFront/favoriteCancel',
        //        type: 'POST',
        //        data: { FMemberId: memberId, FMovieId: movieId },
        //        success: function (response) {
        //            // 成功處理回應的程式碼
        //            // 例如，重新載入喜愛清單
        //            alert('取消收藏成功')
        //            location.reload();

        //        },
        //        error: function (xhr, status, error) {
        //            // 處理錯誤的程式碼
        //            alert('失敗')
        //        }
        //    });
        ////新增收藏
        //function cancelFavorite() {
        //    var memberId = Model.tmember.FMemberId;
        //    var movieId = document.getElementById('heart').getAttribute('data-movie-id');

        //    $.ajax({
        //        url: '/memberFront/favoriteCancel',
        //        type: 'POST',
        //        data: { FMemberId: memberId, FMovieId: movieId },
        //        success: function (response) {
        //            // 成功處理回應的程式碼
        //            // 例如，重新載入喜愛清單
        //            alert('取消收藏成功')
        //            location.reload();

        //        },
        //        error: function (xhr, status, error) {
        //            // 處理錯誤的程式碼
        //            alert('失敗')
        //        }
        //    });


    </script>
}


