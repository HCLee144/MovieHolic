
@{
    ViewData["Title"] = "ViewSession";
    Layout = "~/Views/Shared/BackLayout.cshtml";
}

<h1>ViewSession</h1>

<select id="selectDate" class="form-select" width =20px></select>
<div id="chart"></div>

<span id="test"></span>




@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script>

        const selectDate = document.querySelector('#selectDate');
        const test = document.querySelector('#test');
        var chartData;

        //生成連續21天日期list
        const NowYear = new Date().getFullYear();
        const NowMonth = new Date().getMonth()+1;
        const NowDate = new Date().getDate();
        for(var i=0;i<21;i++){
            let date = `${NowYear}-${NowMonth}-${NowDate+i}`
            let dateString = `<option value="${date}" name="queryDate" id="optionDate">${date}</option>`;
            selectDate.innerHTML += dateString;
        }

        //list在選擇後可以收到選擇日期的session list
        //javascript 沒有針對option的select事件
        //在select上 使用onchange事件
        selectDate.addEventListener('change',async (event)=>{
           let date = selectDate.options[selectDate.selectedIndex].value;
            //const response = await fetch(`@Url.Content("~/SessionBack/getChartDataForSessionByDate")?queryDate=${date}`)
            //chartData = await response.text();
            //test.innerHTML = chartData;
            CreateChart(date);
        })

        //生成表格

        async function CreateChart(date){
            const response = await fetch(`@Url.Content("~/SessionBack/getChartDataForSessionByDate")?queryDate=${date}`)
            chartData = await response.text();
            console.log(chartData)

            var options=
            {
                series: 
                   [ {
                        "name": "鬼噤聲",
                    "data": [
                        {
                                "x": "IMAX廳 - 第1廳",
                            "y": [
                                    1683628800000000,
                                    1683637740000000
                            ]
                        }
                    ]
                    }]
                    ,
                chart: {
                    height: 300,
                    type: 'rangeBar'
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        barHeight: '50%',
                    }
                },
                fill: {
                    type: 'solid'
                },
                xaxis: {
                    type: 'datetime'
                },
                legend: {
                    position: 'right'
                }
            }
            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();

        }

        //var options = {
        //    chart: {
        //        type: 'line'
        //    },
        //    series: [{
        //        name: 'sales',
        //        data: [30, 40, 35, 50, 49, 60, 70, 91, 125]
        //    }],
        //    xaxis: {
        //        categories: [1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
        //    }
        //}


        //var chart = new ApexCharts(document.querySelector("#chart"), options);

        //chart.render();


    </script>
}

